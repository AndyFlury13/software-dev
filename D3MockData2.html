<!DOCTYPE html>
<head>
    <title>D3 Visualization for Mock Data</title>
   <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Open+Sans:400,600">
    <!-- <link rel="stylesheet" type="text/css" href="sequences.css"/> -->
</head>
<body>
D3 Visualization for Mock Data
<script>
d3.csv("./data.csv", function(error, data) {
  if (error) throw error;
  console.log(data);
  // var json = buildHierarchy(csv);
  // var csv = d3.csv.parseRows(data);
  var articles = buildHierarchy(data);
  // console.log(csv[1]);
});

function buildHierarchy(data) {
  var jsons = {}; //create object of json files
  var currArticle = "Article_" + data[0]["Article ID"];
  var root = {"name": "CATEGORIES", "children": []}
  for (var i = 1; i < data.length; i++) { //article ID column
    if ("Article_" + data[i]["Article ID"] !== currArticle) {
      //adds the current article to jsons, resets root to an empty object
      jsons[currArticle] = root;
      currArticle = "Article_" + data[i]["Article ID"];
      var root = {"name": "CATEGORIES", "children": []}
    }
    if (!checkIn(root["children"], data[i]["Credibilty Indicator Category"], "name")) { //credibility column
      //adds a new category to the list of CATEGORIES if it doesn't exist
      root["children"].push({"name": data[i]["Credibilty Indicator Category"], "children": []});
    }
    var categoryIndex = findIndex(root["children"], data[i], "Credibilty Indicator Category");

    // .map(function(e) {return e.name}).indexOf(data[i]["Credibilty Indicator Category"]);
    var cin = root["children"][categoryIndex]["children"]
    if (!checkIn(cin, data[i]["Credibility Indicator Name"], "name")) { //initializes credibility indicator name and score
      //only adds category if it exists
      cin.push({"name": data[i]["Credibility Indicator Name"], "size": 0});
    }
    var cinIndex = findIndex(cin,data[i],  "Credibility Indicator Name");

    // cin.map(function(e) {return e.name}).indexOf(data[i]["Credibility Indicator Name"]);
    cin[cinIndex]["size"] += Math.abs(parseInt(data[i]["Points"]));


  }
  jsons[currArticle] = root;
  console.log(jsons);
  // console.log(jsons["Article_1"]["children"][0]["children"]);
  return jsons; //object of json files for each article
};

function checkIn(data, cat, catName) {
  //checks to see if a category exists already
  for (var i = 0; i < data.length; i++) {
    if (data[i][catName] === cat) {
      return true;
    }
  }
  return false;
}

function findIndex(data, currRow, val) {
  return data.map(function(e) {return e.name}).indexOf(currRow[val]);
}

//drawing Visualization



</script>
<svg>
</svg>

</body>

<!-- <script>

    // Variables
    var width = 500;
    var height = 500;
    var radius = Math.min(width, height) / 2;
    var color = d3.scaleOrdinal(d3.schemeCategory10);

    // Create primary <g> element
    var g = d3.select('svg')
        .attr('width', width)
        .attr('height', height)
        .append('g')
        .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

    // Data strucure
    var partition = d3.partition()
        .size([2 * Math.PI, radius]);

    // Find data root
    var root = d3.hierarchy(nodeData)
        .sum(function (d) { return d.size});

    // Size arcs
    partition(root);
    var arc = d3.arc()
        .startAngle(function (d) { return d.x0 })
        .endAngle(function (d) { return d.x1 })
        .innerRadius(function (d) { return d.y0 })
        .outerRadius(function (d) { return d.y1 });

    // Put it all together
    g.selectAll('path')
        .data(root.descendants())
        .enter().append('path')
        .attr("display", function (d) { return d.depth ? null : "none"; })
        .attr("d", arc)
        .style('stroke', '#fff')
        .style("fill", function (d) { return color((d.children ? d : d.parent).data.name); });
</script> -->
